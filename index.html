<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>S47_SOVEREIGN</title>
    <style>
        /* HUD SKINS */
        :root { --y: #ffcc00; --g: #39ff14; }
        body, html { margin: 0; padding: 0; background: #000; overflow: hidden; height: 100vh; font-family: monospace; color: var(--y); }
        
        #hud { position: absolute; top: 10px; width: 92%; left: 4%; border: 2px solid var(--y); background: rgba(0,0,0,0.8); padding: 10px; z-index: 100; }
        #skin-selector { display: flex; gap: 10px; margin-top: 10px; }
        
        .skin-btn { border: 1px solid var(--y); background: #000; color: var(--y); padding: 5px; font-size: 10px; cursor: pointer; }
        .ctrl-btn { border: 2px solid var(--y); background: #000; color: var(--y); padding: 15px; font-weight: 900; margin-top: 10px; width: 100%; }

        #timer { font-size: 20px; font-weight: 900; text-align: center; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
    </style>
</head>
<body>

    <div id="hud">
        <div id="timer">60.00</div>
        <div id="skin-selector">
            <button class="skin-btn" onclick="setSkin('FATE')">FATE (Beethoven)</button>
            <button class="skin-btn" onclick="setSkin('EIRE')">EIRE (Celtic)</button>
            <button class="skin-btn" onclick="setSkin('VOID')">VOID (G.O.G)</button>
        </div>
        <div style="margin-top:10px; font-size: 10px;">MODE: <span id="mode-name">INIT</span> | LAW: 1*1=2</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // 1. SETUP THE WORLD
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 10000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Position Camera: 45 degree angle, 4x distance
        const r = 300;
        camera.position.set(r*6, r*6, r*6); 
        camera.lookAt(0, 0, 0);

        // 2. THE GEOMETRY (10x10 Grid / 36 degree segments)
        const inner = new THREE.Mesh(new THREE.SphereGeometry(r, 10, 10), new THREE.MeshBasicMaterial({color: 0x00ffff, wireframe: true}));
        const outer = new THREE.Mesh(new THREE.SphereGeometry(r*2, 10, 10), new THREE.MeshBasicMaterial({color: 0xff00ff, wireframe: true, transparent: true, opacity: 0.5}));
        const core = new THREE.Mesh(new THREE.IcosahedronGeometry(r, 1), new THREE.MeshBasicMaterial({color: 0xffffff, wireframe: true}));
        scene.add(inner, outer, core);

        // 3. MUSIC & SKINS LOGIC
        let notes = [];
        let audioCtx;
        
        function playTone(freq) {
            if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            let osc = audioCtx.createOscillator();
            let gain = audioCtx.createGain();
            osc.frequency.value = freq;
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.5);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.5);
        }

        function spawnNote(freq) {
            const m = new THREE.Mesh(new THREE.BoxGeometry(20,20,20), new THREE.MeshBasicMaterial({color: 0xffffff}));
            const dist = 3000;
            const ang = Math.random() * Math.PI * 2;
            m.position.set(Math.cos(ang)*dist, Math.sin(ang)*dist, (Math.random()-0.5)*500);
            scene.add(m);
            notes.push({ mesh: m, freq: freq });
        }

        window.setSkin = (type) => {
            const root = document.documentElement;
            const modeSpan = document.getElementById('mode-name');
            if(type === 'FATE') {
                root.style.setProperty('--y', '#ffcc00');
                modeSpan.innerText = "BEETHOVEN";
                // Sequence: G-G-G-Eb
                spawnNote(392); setTimeout(()=>spawnNote(392), 200); setTimeout(()=>spawnNote(392), 400); setTimeout(()=>spawnNote(311), 600);
            } else if(type === 'EIRE') {
                root.style.setProperty('--y', '#39ff14');
                modeSpan.innerText = "CELTIC";
                spawnNote(174); spawnNote(217);
            } else {
                root.style.setProperty('--y', '#ff00ff');
                modeSpan.innerText = "G.O.G. VOID";
                spawnNote(440);
            }
            if(navigator.vibrate) navigator.vibrate(50);
        };

        // 4. THE ANIMATION LOOP
        let time = 60;
        function animate() {
            time -= 0.016;
            document.getElementById('timer').innerText = Math.max(0, time).toFixed(2);

            // Counter-Rotation
            inner.rotation.y += 0.01;
            outer.rotation.y -= 0.01;
            core.rotation.z += 0.005;

            // Move notes from outside to inside
            for(let i = notes.length-1; i>=0; i--) {
                let n = notes[i];
                n.mesh.position.multiplyScalar(0.98); // Pull to center XYZ00
                
                let d = n.mesh.position.length();
                if(d < 310 && d > 290) { // Hits the Inner Sphere Node
                    playTone(n.freq);
                    n.mesh.material.color.setHex(0x00ffff);
                }
                if(d < 20) { // Resolves at Core
                    scene.remove(n.mesh);
                    notes.splice(i, 1);
                }
            }

            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>
