<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Sultan Sovereign: Spectral Edition</title>
<style>
    :root {
        --gold: #ffd700;
        --plasma: #00ff88;
        --magenta: #ff00ff;
        --hud: #00ffff;
        --bg: radial-gradient(circle at 50% 40%, #001010 0%, #000 90%);
    }
    * { touch-action: none; user-select: none; box-sizing: border-box; }
    html, body {
        margin: 0; padding: 0; height: 100vh; width: 100vw;
        background: var(--bg);
        color: var(--hud);
        font-family: 'Courier New', monospace;
        overflow: hidden;
    }

    /* HUD Top */
    #hud {
        position: absolute;
        top: 0; width: 100%; height: 12%;
        display: flex; justify-content: space-between;
        padding: 15px; font-size: 11px; z-index: 10;
        text-shadow: 0 0 8px var(--hud);
        background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
    }
    #hud span { transition: color 0.3s, text-shadow 0.3s; }

    /* Viewport Zone */
    #viewport {
        height: 70vh; width: 100%;
        display: flex; align-items: center; justify-content: center;
        position: relative; overflow: hidden;
    }

    /* Energy tube visual upgrade */
    .tube {
        position: absolute; left: 15px; width: 14px; height: 85%;
        border: 1px solid var(--plasma);
        background: linear-gradient(to top, rgba(0,255,136,0.15), transparent);
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0,255,136,0.4);
    }
    .bubble {
        position: absolute; width: 8px; height: 8px;
        background: var(--plasma); border-radius: 50%;
        box-shadow: 0 0 10px var(--plasma);
        animation: flow 1.5s infinite linear;
    }
    @keyframes flow {
        0% { bottom: -10px; opacity: 0; }
        50% { opacity: 1; }
        100% { bottom: 100%; opacity: 0; }
    }

    /* Gear Enhancements */
    #gear-zone {
        position: absolute; right: 20px; top: 40%;
        text-align: center; color: var(--magenta);
        filter: drop-shadow(0 0 6px var(--magenta));
    }
    .gear-s {
        width: 60px; height: 60px; border: 3px dashed var(--magenta);
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        font-size: 26px; font-weight: bold;
        animation: spin 3s linear infinite, pulseGear 2s ease-in-out infinite alternate;
    }
    @keyframes spin { from { transform: rotate(0deg);} to {transform: rotate(360deg);} }
    @keyframes pulseGear { from { box-shadow: 0 0 10px var(--magenta);} to { box-shadow: 0 0 30px var(--magenta);} }

    /* Dock Controls */
    #dock {
        height: 30vh; width: 100%;
        background: rgba(0,0,0,0.9);
        border-top: 2px solid #333;
        display: grid; grid-template-columns: 1fr 1.2fr;
        gap: 10px; padding: 15px; z-index: 5;
        padding-bottom: env(safe-area-inset-bottom);
    }
    .btn-grid { display: grid; grid-template-rows: repeat(2, 1fr); gap: 10px; }

    .sultan-btn {
        height: 48px;
        font-weight: bold; font-size: 12px;
        display: flex; align-items: center; justify-content: center;
        border: 2px solid var(--gold);
        color: var(--gold);
        background: transparent;
        border-radius: 8px;
        transition: all 0.2s;
        box-shadow: 0 0 8px rgba(255,215,0,0.3);
    }
    .sultan-btn:active, .sultan-btn.active {
        background: var(--gold);
        color: #000; box-shadow: 0 0 25px var(--gold);
    }
    .btn-gog {
        border-color: var(--magenta);
        color: var(--magenta);
        box-shadow: 0 0 8px rgba(255,0,255,0.4);
    }
    .btn-gog:active, .btn-gog.active {
        background: var(--magenta);
        color: #000; box-shadow: 0 0 25px var(--magenta);
    }
</style>
</head>
<body>
<div id="hud">
    <div id="hud-l">LAW: 1*1=2<br>TICK: <span id="tick-count">00000</span><br>STATUS: NORMAL</div>
    <div id="hud-r" style="text-align:right">SPUN: <span id="rpm-val">15,000</span><br>L©SS: 124K<br><span id="manifold">36° MANIFOLD</span></div>
</div>

<div id="viewport">
    <div class="tube">
        <div class="bubble" style="animation-delay:0s"></div>
        <div class="bubble" style="animation-delay:0.5s"></div>
        <div class="bubble" style="animation-delay:1s"></div>
    </div>
    <div id="gear-zone">
        <div class="gear-s">S</div>
        <small>SETTINGZ</small>
    </div>
</div>

<div id="dock">
    <div class="btn-grid">
        <div class="sultan-btn" id="boostBtn" onpointerdown="input('BOOST', 50)">[H] BOOST</div>
        <div class="sultan-btn" onpointerdown="input('CYCLE', 15)">[∆] CYCLE</div>
    </div>
    <div class="btn-grid">
        <div class="sultan-btn btn-gog" onpointerdown="input('GOG', 100)">[§] INJECT G.O.G.</div>
        <div class="sultan-btn" onpointerdown="input('START', 30)">START MANIFOLD</div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');

let boostActive = false;
const hudStatus = document.querySelector("#hud-l");
const tickDisplay = document.getElementById('tick-count');
const rpmVal = document.getElementById('rpm-val');
const boostBtn = document.getElementById('boostBtn');

// Three.js scene setup
const view = document.getElementById('viewport');
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(45, view.clientWidth / view.clientHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
renderer.setSize(view.clientWidth, view.clientHeight);
view.appendChild(renderer.domElement);

// Lighting + Reactor pieces
const light = new THREE.PointLight(0x00ffff, 1, 50);
light.position.set(5, 5, 5);
scene.add(light);

const coreMaterial = new THREE.MeshStandardMaterial({
    color: 0x00ffff,
    emissive: 0x00ffff,
    emissiveIntensity: 0.5,
    wireframe: false,
    metalness: 0.3, roughness: 0.1
});
const core = new THREE.Mesh(new THREE.IcosahedronGeometry(2.5, 1), coreMaterial);

const shell = new THREE.Mesh(
    new THREE.SphereGeometry(4.2, 32, 32),
    new THREE.MeshBasicMaterial({ color: 0xff00ff, wireframe: true, transparent: true, opacity: 0.3 })
);

const particles = new THREE.Group();
const pMaterial = new THREE.PointsMaterial({ color: 0x00ffff, size: 0.04 });
for(let i=0;i<300;i++){
    const v = new THREE.Vector3(
        (Math.random()-0.5)*10,
        (Math.random()-0.5)*10,
        (Math.random()-0.5)*10
    );
    particles.add(new THREE.Points(new THREE.BufferGeometry().setFromPoints([v]), pMaterial));
}

scene.add(core, shell, particles);
camera.position.z = 12;

// State logic
function input(type, vibration) {
    if (navigator.vibrate) navigator.vibrate(vibration);

    if (type === 'BOOST') {
        boostActive = !boostActive;
        boostBtn.classList.toggle('active', boostActive);
        hudStatus.innerHTML = boostActive 
            ? `LAW: REVERSE<br>TICK: <span id="tick-count">${tickDisplay.innerText}</span><br>STATUS: OVERDRIVE` 
            : `LAW: 1*1=2<br>TICK: <span id="tick-count">${tickDisplay.innerText}</span><br>STATUS: NORMAL`;
    }
    if (type === 'GOG') {
        core.material.color.setHex(0xff00ff);
        core.material.emissive.setHex(0xff00ff);
        setTimeout(()=> {
            core.material.color.setHex(0x00ffff);
            core.material.emissive.setHex(0x00ffff);
        },300);
    }
}

// Resizing
window.addEventListener('resize', () => {
    camera.aspect = view.clientWidth / view.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(view.clientWidth, view.clientHeight);
});

// Animation pulse
let ticks=0, hue=180;
function animate(){
    const speed = boostActive ? 0.08 : 0.015;
    core.rotation.y += speed;
    shell.rotation.y -= speed * 0.5;
    shell.rotation.x += speed * 0.2;

    ticks++;
    if(ticks%5===0) tickDisplay.textContent = ticks.toString().padStart(5,'0');

    // Glow & pulse
    hue = (hue + (boostActive ? 2 : 0.3)) % 360;
    const color = new THREE.Color(`hsl(${hue},100%,60%)`);
    core.material.emissive = color;
    particles.children.forEach((p,i)=>p.rotation.z+=0.001*i);

    renderer.render(scene, camera);
    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
