<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22S47_358%22,%22display%22:%22standalone%22}">
    <title>358_SOVEREIGN</title>
    <style>
        :root { --y: #ffcc00; --g: #39ff14; }
        body, html { margin: 0; padding: 0; background: #000; overflow: hidden; height: 100vh; font-family: monospace; color: var(--y); }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #hud { position: absolute; top: 10; width: 94%; left: 3%; display: flex; justify-content: space-between; border: 1px solid var(--y); background: rgba(0,0,0,0.8); padding: 8px; z-index: 100; font-size: 12px; }
        #ctrl { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: center; gap: 10px; z-index: 100; }
        .b { border: 2px solid var(--y); background: #000; color: var(--y); padding: 15px; font-weight: 900; }
        #matrix-bg { z-index: 1; opacity: 0.3; }
        #three-canvas { z-index: 10; pointer-events: none; }
    </style>
</head>
<body>

    <canvas id="matrix-bg"></canvas>
    <div id="hud">
        <div>®: <span id="rpm">0</span><br>§: <span id="pull">0</span>%</div>
        <div style="color:var(--g)" id="timer">60.00</div>
        <div style="text-align:right;">5D_SLICE<br>LAW: 1*1=2</div>
    </div>

    <div id="ctrl">
        <button class="b" onclick="modRPM(5000)">+RPM</button>
        <button class="b" onclick="inject360()">INJECT</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // 1. Matrix Grounding
        const mtx = document.getElementById('matrix-bg');
        const mctx = mtx.getContext('2d');
        let w, h;
        const resize = () => { w = mtx.width = window.innerWidth; h = mtx.height = window.innerHeight; };
        window.onresize = resize; resize();
        const drops = Array(Math.floor(w/20)).fill(1);

        // 2. Three.js Setup
        const s = new THREE.Scene();
        const cam = new THREE.PerspectiveCamera(55, w/h, 1, 10000);
        cam.position.z = 1000;
        const ren = new THREE.WebGLRenderer({antialias: false, alpha: true});
        ren.domElement.id = "three-canvas";
        ren.setSize(w, h);
        document.body.appendChild(ren.domElement);

        const g = new THREE.Group();
        const starA = new THREE.Mesh(new THREE.SphereGeometry(80, 16, 16), new THREE.MeshBasicMaterial({color: 0x00ffff, wireframe: true}));
        const starB = new THREE.Mesh(new THREE.SphereGeometry(80, 16, 16), new THREE.MeshBasicMaterial({color: 0xff00ff, wireframe: true}));
        starA.position.x = -400; starB.position.x = 400;
        const ico = new THREE.Mesh(new THREE.IcosahedronGeometry(100, 1), new THREE.MeshBasicMaterial({color: 0xffffff, wireframe: true, transparent: true, opacity: 0}));
        g.add(starA, starB, ico);
        s.add(g);

        // 3. Variables & Physics
        let rpm = 0, time = 60, born = false, particles = [];

        window.modRPM = (v) => { 
            rpm += v; 
            if(navigator.vibrate) navigator.vibrate(30); 
        };

        window.inject360 = () => {
            if(born) return;
            for(let i=0; i<36; i++) {
                let m = new THREE.Mesh(new THREE.BoxGeometry(10,10,10), new THREE.MeshBasicMaterial({color: 0xffffff}));
                let a = (i/36) * 6.28;
                m.position.set(Math.cos(a)*800, Math.sin(a)*800, 0);
                s.add(m); particles.push(m);
            }
        };

        // 4. Main Loop
        function loop() {
            time -= 0.016;
            document.getElementById('timer').innerText = Math.max(0, time).toFixed(2);
            document.getElementById('rpm').innerText = rpm;

            // Matrix Logic
            mctx.fillStyle = "rgba(0,0,0,0.1)";
            mctx.fillRect(0,0,w,h);
            mctx.fillStyle = born ? "#fff" : "#39ff14";
            drops.forEach((y, i) => {
                mctx.fillText(Math.random() > .5 ? "1" : "0", i*20, y*20);
                drops[i] = y*20 > h ? 0 : y + (1 + rpm/20000);
            });

            if(!born) {
                let grav = (rpm/100000) * 0.1;
                document.getElementById('pull').innerText = (grav*1000).toFixed(0);
                starA.position.x += (rpm * 0.00005); starB.position.x -= (rpm * 0.00005);
                particles.forEach(p => p.position.multiplyScalar(1 - grav));
                if(time <= 30) born = true;
            } else {
                ico.material.opacity = 1;
                g.rotation.y += 0.05 + (rpm/1000000);
                particles.forEach(p => p.position.multiplyScalar(0.95));
            }

            ren.render(s, cam);
            requestAnimationFrame(loop);
        }
        loop();
    </script>
</body>
</html>
